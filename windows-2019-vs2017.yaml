---
variables:
  nodejs_version: 12.18.3
  headless: 'true'
builders:
  - name: windows-2019-vs2017-amd64-virtualbox
    type: virtualbox-ovf
    source_path: windows-2019-nvm-amd64-virtualbox.ova
    # checksum: sha256:68ef706501fffe4a07bdeb5fb18072c77b57ec1ae7312e4dc7d816ed2e9f10fa
    checksum: none
    guest_additions_mode: disable
    communicator: winrm
    winrm_username: vagrant
    winrm_password: vagrant
    shutdown_command: shutdown /s /t 0 /f /d p:4:1 /c "Packer Shutdown"
    # headless: '{{user `headless`}}'
    format: ova
    export_opts:
      - --manifest
      - --ovf20
provisioners:
  - type: powershell
    inline: '$ErrorActionPreference = "Stop"; $pieces=@("IIS-ApplicationDevelopment", "IIS-ASPNET45", "IIS-WebSockets"); $pieces.ForEach({Enable-WindowsOptionalFeature -Online -Featurename $_ -All}); iisreset'
  - type: powershell
    inline: 'choco install -y dotnetfx'
    valid_exit_codes:
      - 0
      - 3010
  - type: windows-restart
#       '
# Get-WindowsOptionalFeature -online -featurename IIS-WebServer-Role -all'
#   - type: powershell
#     inline: 'Get-Windows'
  - type: powershell
    inline: 'choco install -y visualstudio2017community'
    valid_exit_codes:
      - 0
      - 3010
